! Configuration File for keepalived

global_defs {
router_id LVS
!script_user root
!enable_script_security
}


vrrp_instance VI_1 {
  state BACKUP
  interface eth0
  virtual_router_id 51
  priority {{ priority }}
  advert_int 1
  nopreempt
  authentication {
    auth_type PASS
    auth_pass 123456
  }
  virtual_ipaddress {
    {{ virtual_ip }}
  }
}

virtual_server {{ virtual_ip }} {{ virtual_port }} {
  delay_loop 6
  lb_algo rr
  lb_kind DR
  protocol UDP

{% for host in groups['rs'] %}
  real_server {{ host }} {{ virtual_port }} {
    weight 1
    MISC_CHECK {
      misc_path /etc/keepalived/chk_ntp.sh {{ host }}
      misc_dynamic
    }

  }
{% endfor %}
}
